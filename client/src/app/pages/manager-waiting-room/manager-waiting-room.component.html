<div class="mwr-scene">
    <!-- Ambient background effects -->
    <div class="mwr-orb mwr-orb-1"></div>
    <div class="mwr-orb mwr-orb-2"></div>
    <div class="mwr-orb mwr-orb-3"></div>
    <div class="mwr-particles">
        <span *ngFor="let p of particles" class="particle"
              [style.left]="p.x + '%'"
              [style.animationDelay]="p.delay + 's'"
              [style.animationDuration]="p.duration + 's'"></span>
    </div>

    <!-- Floating action bar -->
    <div class="mwr-action-bar">
        <button class="mwr-btn mwr-btn-cancel" (click)="cancelGame()">
            <i class="material-icons">close</i>
            <span>{{ 'BUTTONS.CANCEL' | translate }}</span>
        </button>
        <button class="mwr-btn mwr-btn-lock" [class.locked]="waitingRoomIsLocked" (click)="onLockWaitingRoom()">
            <i class="material-icons">{{ waitingRoomIsLocked ? 'lock' : 'lock_open' }}</i>
            <span>{{ getTranslationLock() | translate }}</span>
        </button>
    </div>

    <!-- Central stage -->
    <div class="mwr-stage">
        <!-- Access Code Hero -->
        <div class="mwr-hero">
            <div class="mwr-code-ring">
                <div class="mwr-ring-track"></div>
                <div class="mwr-ring-dot"></div>
            </div>
            <span class="mwr-code-label">{{ 'JOIN_MATCH.ACCESS_CODE' | translate }}</span>
            <div class="mwr-code-digits">
                <span *ngFor="let digit of accessCodeDigits; let i = index"
                      class="mwr-digit"
                      [style.animationDelay]="(i * 0.12) + 's'">{{ digit }}</span>
            </div>
            <button class="mwr-copy-btn" [cdkCopyToClipboard]="accessCode" (click)="copyCode()" [class.copied]="isCopied">
                <i class="material-icons">{{ isCopied ? 'check_circle' : 'content_copy' }}</i>
                <span>{{ isCopied ? 'Copied!' : 'Copy code' }}</span>
            </button>
        </div>

        <!-- Status Message -->
        <div class="mwr-status">
            <div class="mwr-status-pill" *ngIf="!matchSrv.match.players.length">
                <span class="mwr-status-dot-pulse"></span>
                <span>{{ 'TITLES.INVITE_PLAYERS' | translate }}</span>
            </div>
            <div class="mwr-status-pill"
                 *ngIf="matchSrv.match.players.length && isMinPlayersConditionValid() && areAllTeamsValid() && !waitingRoomIsLocked">
                <i class="material-icons">lock_outline</i>
                <span>{{ 'TITLES.LOCK_MATCH' | translate }}</span>
            </div>
            <div class="mwr-status-pill warn" *ngIf="matchSrv.match.players.length && !isMinPlayersConditionValid()">
                <i class="material-icons">info_outline</i>
                <span>{{ 'TITLES.MIN_TEAM_PLAYERS' | translate }}</span>
            </div>
            <div class="mwr-status-pill warn" *ngIf="isMinPlayersConditionValid() && !areAllTeamsValid()">
                <i class="material-icons">info_outline</i>
                <span>{{ 'TITLES.VALID_TEAMS' | translate }}</span>
            </div>
        </div>

        <!-- Players Panel (Solo) -->
        <section class="mwr-players-panel" *ngIf="!matchSrv.match.isTeamMatch">
            <div class="mwr-panel-header">
                <i class="material-icons">groups</i>
                <span>{{ 'TITLES.PLAYERS_CONNECTED' | translate }}</span>
                <span class="mwr-badge">{{ matchSrv.match.players.length }}</span>
            </div>

            <div class="mwr-players-wrap" *ngIf="matchSrv.match.players.length">
                <app-player-card
                    *ngFor="let player of matchSrv.getPlayersNotInTeam(); let i = index"
                    [player]="player"
                    [isManager]="true"
                    [accessCode]="accessCode"
                    [style.animationDelay]="(i * 0.08) + 's'"
                    class="mwr-card-enter"
                ></app-player-card>
            </div>

            <div class="mwr-empty" *ngIf="!matchSrv.match.players.length">
                <div class="mwr-empty-radar">
                    <div class="mwr-radar-sweep"></div>
                    <i class="material-icons">wifi_tethering</i>
                </div>
                <span>Scanning for players...</span>
            </div>
        </section>

        <!-- Team Mode -->
        <div class="mwr-team-layout" *ngIf="matchSrv.match.isTeamMatch">
            <section class="mwr-panel mwr-unassigned-panel">
                <div class="mwr-panel-header">
                    <i class="material-icons">person_outline</i>
                    <span>Unassigned</span>
                    <span class="mwr-badge">{{ matchSrv.getPlayersNotInTeam().length }}</span>
                </div>
                <div class="mwr-panel-body">
                    <app-player-card
                        *ngFor="let player of matchSrv.getPlayersNotInTeam(); let i = index"
                        [player]="player"
                        [isManager]="true"
                        [accessCode]="accessCode"
                        [style.animationDelay]="(i * 0.08) + 's'"
                        class="mwr-card-enter"
                    ></app-player-card>
                </div>
            </section>
            <section class="mwr-teams-area">
                <div class="mwr-panel-header">
                    <i class="material-icons">groups</i>
                    <span>Teams</span>
                    <span class="mwr-badge">{{ matchSrv.match.teams.length }}</span>
                </div>
                <div class="mwr-teams-grid">
                    <div *ngFor="let team of matchSrv.match.teams; let i = index"
                         class="mwr-team-card"
                         [style.animationDelay]="(i * 0.1) + 's'">
                        <div class="mwr-team-head">
                            <i class="material-icons">shield</i>
                            <h3>{{ team.name }}</h3>
                            <span class="mwr-team-count">{{ team.players.length }}/2</span>
                        </div>
                        <div class="mwr-team-body">
                            <app-player-card
                                *ngFor="let player of team.players"
                                [player]="{ name: player, isActive: true, score: 0, nBonusObtained: 0, chatBlocked: false, avatar: player }"
                                [isManager]="true"
                                [accessCode]="accessCode"
                            ></app-player-card>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Start Button -->
        <button
            class="mwr-start-btn"
            (click)="onBeginMatch()"
            [disabled]="!matchSrv.match.players.length || !waitingRoomIsLocked || !isMinPlayersConditionValid() || !areAllTeamsValid()"
            [class.ready]="matchSrv.match.players.length && waitingRoomIsLocked && isMinPlayersConditionValid() && areAllTeamsValid()"
        >
            <span class="mwr-start-bg"></span>
            <span class="mwr-start-content">
                <i class="material-icons">play_arrow</i>
                <span>{{ 'NAV_BUTTONS.START_MATCH' | translate }}</span>
            </span>
        </button>
    </div>
</div>
