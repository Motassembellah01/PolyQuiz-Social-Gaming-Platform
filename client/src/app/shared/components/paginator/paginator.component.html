<ng-template #filtrationDialog>
    <div
        class="filter-dialog-content"
        [ngClass]="{
            'light-mode': this.accountService.theme === 'light',
            'dialog-dark': this.accountService.theme === 'dark',
            'dialog-christmas': this.accountService.theme === 'christmas',
            'dialog-valentines': this.accountService.theme === 'valentines',
        }"
    >
        <div class="sort-menu" *ngIf="!inAdminVue">
            <div class="dialog-header">
                <span class="material-icons dialog-icon">tune</span>
                <h3>{{ 'FILTERS.TITLE' | translate }}</h3>
            </div>

            <div class="filter-group">
                <label for="sort-by">{{ 'FILTERS.SORT_BY' | translate }}</label>
                <select id="sort-by" [(ngModel)]="tempSortBy">
                    <option value="category">{{ 'FILTERS.CATEGORY' | translate }}</option>
                    <option value="rating">{{ 'FILTERS.RATING' | translate }}</option>
                </select>
            </div>

            <div *ngIf="tempSortBy === 'category'" class="categorie-options">
                <div class="filter-group">
                    <label for="type">{{ 'FILTERS.TYPE' | translate }}</label>
                    <select id="type" [(ngModel)]="tempSelectedType">
                        <option value="difficulties">{{ 'FILTERS.DIFFICULTY' | translate }}</option>
                        <option value="interests">{{ 'FILTERS.INTEREST' | translate }}</option>
                        <option value="durations">{{ 'FILTERS.DURATION' | translate }}</option>
                    </select>
                </div>

                <div class="filter-group">
                    <label for="categories">{{ 'FILTERS.TAG' | translate }}</label>
                    <select id="categories" [(ngModel)]="tempSelectedCategory">
                        <option *ngFor="let category of categories[tempSelectedType]" [value]="category">
                            {{ category }}
                        </option>
                    </select>
                </div>
            </div>
        </div>

        <div class="dialog-actions">
            <button class="dialog-btn cancel-btn" mat-dialog-close>{{ 'BUTTONS.CANCEL' | translate }}</button>
            <button class="dialog-btn apply-btn" mat-dialog-close (click)="applyFilters()">{{ 'FILTERS.APPLY' | translate }}</button>
        </div>
    </div>
</ng-template>

<div
    *ngIf="!inAdminVue"
    class="paginator-theme-wrapper"
    [ngClass]="{
        'theme-dark': this.accountService.theme === 'dark',
        'theme-christmas': this.accountService.theme === 'christmas',
        'theme-valentines': this.accountService.theme === 'valentines'
    }"
>
    <div class="filter-bar">
        <button class="filter-btn" (click)="openFilterDialog()">
            <span class="material-icons">tune</span>
            <span>{{ 'FILTERS.FILTER' | translate }}</span>
        </button>
        <div class="active-filter-tag" *ngIf="isFilterApplied() && sortBy">
            <span class="material-icons tag-icon">label</span>
            <span class="tag-text" *ngIf="sortBy === 'category'">{{ selectedCategory }}</span>
            <span class="tag-text" *ngIf="sortBy === 'rating'">{{ 'FILTERS.RATING' | translate }}</span>
            <button
                class="tag-close"
                (click)="clearAllFilters()"
                matTooltip="{{ 'FILTERS.REMOVE' | translate }}"
            >
                <span class="material-icons">close</span>
            </button>
        </div>
    </div>

    <div class="game-cards">
        <ng-container *ngFor="let filteredGame of dataSource.data">
            <div
                class="game-card"
                *ngIf="filteredGame.game.isVisible"
                (click)="navigatePreview(filteredGame.game.id)"
            >
                <div class="card-accent"></div>
                <div class="card-body">
                    <div class="card-content">
                        <h3 class="game-title">{{ filteredGame.game | localizedField:'title' }}</h3>
                        <p class="game-description" *ngIf="filteredGame.game.description">
                            {{ filteredGame.game | localizedField:'description' }}
                        </p>
                        <div class="game-meta">
                            <span class="meta-chip" *ngIf="filteredGame.game.questions?.length">
                                <span class="material-icons">quiz</span>
                                {{ filteredGame.game.questions.length }}
                            </span>
                            <span class="meta-chip" *ngIf="filteredGame.game.duration">
                                <span class="material-icons">timer</span>
                                {{ filteredGame.game.duration }}s
                            </span>
                            <span class="meta-chip rating-chip" *ngIf="isFilterApplied() && sortBy === 'rating'">
                                <span class="material-icons">star</span>
                                {{ filteredGame.weightedRating | number: '1.1-1' }}
                            </span>
                            <span class="meta-chip category-chip" *ngIf="isFilterApplied() && sortBy === 'category' && selectedCategory">
                                {{ filteredGame.categoryDetail }}
                            </span>
                        </div>
                    </div>
                    <div class="card-arrow">
                        <span class="material-icons">chevron_right</span>
                    </div>
                </div>
            </div>
        </ng-container>

        <div class="empty-state" *ngIf="dataSource.data.length === 0">
            <span class="material-icons empty-icon">sports_esports</span>
            <p class="empty-title">No games available</p>
            <p class="empty-subtitle">Check back later or create a new game</p>
        </div>
    </div>

    <div class="paginator-container">
        <mat-paginator
            [length]="nbGames"
            [pageSize]="4"
            [pageSizeOptions]="[2, 4, 6]"
            (page)="onPageChange($event)"
            class="create-paginator"
        ></mat-paginator>
    </div>
</div>

<div *ngIf="inAdminVue" class="admin-view">
    <div class="games-container">
        <app-game-panel *ngFor="let filteredGame of dataSource.data" [gameDirective]="filteredGame.game"></app-game-panel>
    </div>

    <div class="admin-empty-state" *ngIf="dataSource.data.length === 0">
        <span class="material-icons admin-empty-icon">inventory_2</span>
        <p class="admin-empty-title">{{ 'TITLES.NO_GAMES' | translate }}</p>
        <p class="admin-empty-subtitle">{{ 'TITLES.NO_GAMES_SUBTITLE' | translate }}</p>
    </div>

    <div class="paginator-container">
        <mat-paginator
            [length]="nbGames"
            [pageSize]="4"
            [pageSizeOptions]="[2, 4, 6]"
            (page)="onPageChange($event)"
            class="admin-paginator"
        ></mat-paginator>
    </div>
</div>
